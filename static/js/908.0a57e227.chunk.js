"use strict";(self.webpackChunkszwagecalc=self.webpackChunkszwagecalc||[]).push([[16,908],{61:(e,t,a)=>{a.d(t,{a:()=>r,b:()=>n});const r=[{id:"brand-purple",name:"\ube0c\ub79c\ub4dc \ud37c\ud50c",value:"var(--accent-primary)",textLight:"var(--accent-text)",textDark:"var(--accent-text)",inactive:"rgba(139, 92, 246, 0.25)"},{id:"success-green",name:"\uc11d\uc138\uc2a4 \uadf8\ub9b0",value:"var(--success-primary)",textLight:"var(--text-inverse)",textDark:"var(--text-inverse)",inactive:"rgba(34, 197, 94, 0.25)"},{id:"warning-orange",name:"\uc6cc\ub2dd \uc624\ub80c\uc9c0",value:"var(--warning-primary)",textLight:"var(--text-inverse)",textDark:"var(--text-inverse)",inactive:"rgba(249, 115, 22, 0.25)"},{id:"error-red",name:"\uc5d0\ub7ec \ub808\ub4dc",value:"var(--error-primary)",textLight:"var(--text-inverse)",textDark:"var(--text-inverse)",inactive:"rgba(239, 68, 68, 0.25)"},{id:"blue",name:"\ube14\ub8e8",value:"#2563EB",textLight:"#FFFFFF",textDark:"#FFFFFF",inactive:"rgba(37, 99, 235, 0.25)"},{id:"fuchsia",name:"\ud4e8\uc2dc\uc544",value:"#C026D3",textLight:"#FFFFFF",textDark:"#FFFFFF",inactive:"rgba(192, 38, 211, 0.25)"},{id:"coffee-brown",name:"\ucee4\ud53c \ube0c\ub77c\uc6b4",value:"#8B5E3C",textLight:"#FFFFFF",textDark:"#FFFFFF",inactive:"rgba(139, 94, 60, 0.25)"}],s=r[0],i=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=r.find(t=>t.value===e);if(a)return t?a.textDark:a.textLight;if(!e)return t?"#FFFFFF":"#1F2937";if(e.startsWith("var("))return"var(--text-inverse)";const s=e.replace("#","");return(.299*parseInt(s.substr(0,2),16)+.587*parseInt(s.substr(2,2),16)+.114*parseInt(s.substr(4,2),16))/255>.5?"#1F2937":"#FFFFFF"},n=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=e.color||s.value,l=(o=n,r.find(e=>e.value===o)||s);var o;return t?{backgroundColor:n,color:i(n,a),borderColor:n}:{backgroundColor:l?l.inactive:"rgba(0,0,0,0.1)",color:"var(--text-secondary)",borderColor:l?l.inactive:"rgba(0,0,0,0.1)"}}},3908:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var r=a(5043),s=a(446),i=a.n(s),n=a(2521),l=a(6632),o=a(8188),d=a(5843),c=a(5016),m=a(9994),u=a(253),x=a(8521),g=a(61),b=a(579);const h=(e,t)=>{if(!e||!t)return"0\uc2dc\uac04 0\ubd84";const a=(0,n.a)(e);let r=(0,n.a)(t);if(!a||!r)return"0\uc2dc\uac04 0\ubd84";r.isBefore(a)&&(r=r.add(1,"day"));const s=r.diff(a,"minute"),i=Math.floor(s/60),l=s%60;let o="";return i>0&&(o+="".concat(i,"\uc2dc\uac04 ")),o+="".concat(l,"\ubd84"),o.trim()},f=e=>{let{selectedDate:t,isOpen:a,onClose:s,session:n,jobs:f}=e;const y=(0,m.b)(),k=(0,u.b)(),{openModal:p,closeModal:v}=(0,o.a)(),[j,w]=(0,r.useState)([]),[_,N]=(0,r.useState)(!1),[M,F]=(0,r.useState)(null),[C,S]=(0,r.useState)(!1),[D,T]=(0,r.useState)(!1),Y=(0,r.useCallback)(async()=>{if(!n||!t)return;const e=i()(t).format("YYYY-MM-DD"),{data:a,error:r}=await d.a.from("work_records").select("*, jobs(job_name, color, break_time_enabled, break_time_paid, break_time_policies)").eq("date",e).eq("user_id",n.user.id).order("start_time",{ascending:!0});r?console.error("Error fetching daily records:",r):w(a)},[n,t]),[E,H]=(0,r.useState)(new Map),L=(0,r.useCallback)(async()=>{if(!n||!j.length||!t)return;const e=new Map,a=i()(t).format("YYYY-MM-DD");if("Invalid date"!==a&&i()(t).isValid()){for(const t of j)if("hourly"===t.wage_type&&t.job_id){const{data:r,error:s}=await d.a.from("hourly_rate_history").select("hourly_rate").eq("job_id",t.job_id).eq("user_id",n.user.id).lte("effective_date",a).or("end_date.is.null,end_date.gte."+a).order("effective_date",{ascending:!1}).limit(1);!s&&null!==r&&void 0!==r&&r[0]&&e.set(t.id,r[0].hourly_rate)}H(e)}else console.warn("Invalid selectedDate:",t)},[n,j,t]);(0,r.useEffect)(()=>{a&&j.length>0&&L()},[L,a,j.length]),(0,r.useEffect)(()=>{a?(S(!0),setTimeout(()=>T(!0),10),p(),Y()):(T(!1),setTimeout(()=>{S(!1),H(new Map)},300),v())},[a,Y,p,v]),(0,r.useEffect)(()=>()=>{v()},[v]);return C?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex items-center justify-center p-4 transition-opacity duration-300 ease-out ".concat(D?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"," z-layer-modal"),children:(0,b.jsxs)("div",{className:"bg-cream-white dark:bg-gray-900 rounded-2xl shadow-lg dark:shadow-2xl dark:shadow-black/50 w-full max-w-lg max-h-[90vh] overflow-y-auto p-6 transform transition-all duration-300 ease-out ".concat(D?"translate-y-0 scale-100":"translate-y-10 scale-95"),children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-dark-navy dark:text-white",children:t&&i()(t).isValid()?i()(t).format("YYYY\ub144 M\uc6d4 D\uc77c (ddd)"):"\ub0a0\uc9dc \uc120\ud0dd"}),(0,b.jsx)("button",{onClick:s,className:"text-medium-gray dark:text-light-gray hover:text-dark-navy dark:hover:text-white text-2xl transition-all duration-200 ease-in-out transform hover:scale-105",children:"\xd7"})]}),f&&f.length>0&&(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"\uc9c1\uc5c5\ubcc4 \uc8fc\ud734\uc218\ub2f9 \uc801\uc6a9 \ud604\ud669"}),(0,b.jsx)("div",{className:"grid grid-cols-1 gap-2",children:f.map(e=>{const a=j.some(t=>t.job_id===e.id&&t.is_unexcused_absence),r=j.some(t=>t.job_id===e.id&&!t.is_unexcused_absence);return(0,b.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,b.jsx)("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:e.color||"#6B7280"}}),(0,b.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300 font-medium truncate",children:e.job_name}),r&&(0,b.jsx)("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 px-2 py-0.5 rounded-full whitespace-nowrap",children:"\uadfc\ubb34"})]})}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"flex items-center gap-2",children:!r&&(0,b.jsxs)("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[(0,b.jsx)("input",{type:"checkbox",checked:a,className:"w-3.5 h-3.5 text-gray-600 bg-gray-100 border-gray-300 rounded focus:ring-gray-500 dark:focus:ring-gray-600 dark:ring-offset-gray-800 focus:ring-1 dark:bg-gray-700 dark:border-gray-600",onChange:a=>(async(e,a)=>{if(!n||!t||!e)return;const r=i()(t).format("YYYY-MM-DD"),s=f.find(t=>t.id===e);if(a){const{error:t}=await d.a.from("work_records").insert({user_id:n.user.id,job_id:e,date:r,start_time:null,end_time:null,daily_wage:0,meal_allowance:0,notes:"".concat((null===s||void 0===s?void 0:s.job_name)||"\uc9c1\uc5c5"," \ubb34\ub2e8\uacb0\uadfc"),wage_type:"daily",work_description:"\ubb34\ub2e8\uacb0\uadfc",is_unexcused_absence:!0});if(t)console.error("Error creating absence record:",t),k("\ubb34\ub2e8\uacb0\uadfc \uae30\ub85d\uc5d0 \uc2e4\ud328\ud588\uc5b4\uc694","error");else{k("".concat((null===s||void 0===s?void 0:s.job_name)||"\uc9c1\uc5c5"," \ubb34\ub2e8\uacb0\uadfc\uc73c\ub85c \uae30\ub85d\ud588\uc5b4\uc694"),"success"),Y();try{window.dispatchEvent(new Event("work-records-changed"))}catch(l){}}}else{const{error:t}=await d.a.from("work_records").delete().eq("user_id",n.user.id).eq("job_id",e).eq("date",r).eq("is_unexcused_absence",!0);if(t)console.error("Error removing absence record:",t),k("\ubb34\ub2e8\uacb0\uadfc \ud574\uc81c\uc5d0 \uc2e4\ud328\ud588\uc5b4\uc694","error");else{k("".concat((null===s||void 0===s?void 0:s.job_name)||"\uc9c1\uc5c5"," \ubb34\ub2e8\uacb0\uadfc\uc744 \ud574\uc81c\ud588\uc5b4\uc694"),"success"),Y();try{window.dispatchEvent(new Event("work-records-changed"))}catch(l){}}}})(e.id,a.target.checked)}),(0,b.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 whitespace-nowrap",children:"\ubb34\ub2e8\uacb0\uadfc"})]})}),(0,b.jsx)("div",{className:"flex-shrink-0",children:e.weekly_allowance_enabled?a?(0,b.jsx)("span",{className:"text-xs text-red-500 dark:text-red-400 whitespace-nowrap",children:"\uc8fc\ud734\uc218\ub2f9 \u2715"}):(0,b.jsx)("span",{className:"text-xs text-blue-500 dark:text-blue-400 whitespace-nowrap",children:"\uc8fc\ud734\uc218\ub2f9 \u25cb"}):(0,b.jsx)("span",{className:"text-xs text-gray-400 dark:text-gray-500 whitespace-nowrap",children:"\uc8fc\ud734\uc218\ub2f9 \ubbf8\uc801\uc6a9"})})]})]},e.id)})}),f.some(e=>e.weekly_allowance_enabled)&&(0,b.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 text-center",children:"\ubb34\ub2e8\uacb0\uadfc \uc2dc \ud574\ub2f9 \uc9c1\uc5c5\uc758 \uc8fc\ud734\uc218\ub2f9\uc774 \uc81c\uc678\ub429\ub2c8\ub2e4"})]}),(0,b.jsx)("div",{className:"space-y-6",children:0===j.length?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("p",{className:"text-medium-gray dark:text-light-gray text-lg",children:"\uae30\ub85d\ub41c \uadfc\ubb34\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."}),(0,b.jsx)("p",{className:"text-sm text-medium-gray dark:text-light-gray mt-2",children:"\uc9c0\uae08 \ubc14\ub85c \uccab \uadfc\ubb34\ub97c \ucd94\uac00\ud574\ubcf4\uc138\uc694!"})]}):j.map(e=>{var t,a,r;return(0,b.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-5 border border-gray-200 dark:border-gray-700 hover:shadow-md transition-all duration-200",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(null===(t=e.jobs)||void 0===t?void 0:t.job_name)&&(0,b.jsx)("span",{className:"inline-block px-3 py-1 rounded-full text-sm font-medium mb-2",style:(0,g.b)(e.jobs,!0),children:e.jobs.job_name}),(0,b.jsxs)("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400 mb-2",children:["+",(()=>{if("daily"===e.wage_type)return(e.daily_wage||0).toLocaleString();if(e.start_time&&e.end_time&&e.jobs){const t=E.get(e.id)||0;if(t>0){const a=(0,l.c)(e.start_time,e.end_time,e.jobs);let r=a.workHours;a.breakTime.isPaid&&(r=a.totalHours);return(Math.round(r*t)+(e.meal_allowance||0)).toLocaleString()}}return(e.daily_wage||0).toLocaleString()})(),"\uc6d0"]}),(0,b.jsxs)("div",{className:"text-gray-600 dark:text-gray-400 space-y-1",children:[(0,b.jsxs)("p",{className:"text-base",children:[(null===(a=e.start_time)||void 0===a?void 0:a.slice(0,5))||"--:--"," ~ ",(null===(r=e.end_time)||void 0===r?void 0:r.slice(0,5))||"--:--"]}),(0,b.jsxs)("p",{className:"text-sm",children:["\ucd1d ",h(e.start_time,e.end_time)]}),(()=>{if(!e.start_time||!e.end_time||!e.jobs)return null;const t=(0,l.c)(e.start_time,e.end_time,e.jobs);return 0===t.breakTime.breakMinutes?null:(0,b.jsxs)("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:["\u23f0 \ud734\uac8c\uc2dc\uac04 ",(0,l.f)(t.breakTime.breakMinutes),(0,b.jsxs)("span",{className:"ml-1 text-xs ".concat(t.breakTime.isPaid?"text-green-600 dark:text-green-400":"text-orange-600 dark:text-orange-400"),children:["(",t.breakTime.isPaid?"\uc720\uae09":"\ubb34\uae09",")"]})]})})()]})]}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)("button",{onClick:()=>(e=>{F(e),N(!0)})(e),className:"p-2 text-blue-600 hover:bg-blue-100 dark:hover:bg-blue-900/20 rounded-lg transition-colors",children:(0,b.jsx)(x.x,{size:16})}),(0,b.jsx)("button",{onClick:()=>(async e=>{n&&y("\uc815\ub9d0 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc5b4\uc694?",async()=>{const{error:t}=await d.a.from("work_records").delete().eq("id",e).eq("user_id",n.user.id);t?(console.error("Error deleting record:",t),k("\uc0ad\uc81c\ud558\uc9c0 \ubabb\ud588\uc5b4\uc694","error")):(k("\uc0ad\uc81c\ud588\uc5b4\uc694","success"),Y())})})(e.id),className:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:(0,b.jsx)(x.G,{size:16})})]})]}),((e.meal_allowance||0)>0||e.notes)&&(0,b.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-600 space-y-2",children:[(e.meal_allowance||0)>0&&(0,b.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["\ud83d\udcb0 \uc2dd\ub300: ",(e.meal_allowance||0).toLocaleString(),"\uc6d0"]}),e.notes&&(0,b.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["\ud83d\udcdd ",e.notes]})]})]},e.id)})}),j.length>0&&(0,b.jsxs)("div",{className:"mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl border border-blue-200 dark:border-blue-800",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-blue-800 dark:text-blue-300 mb-3",children:"\ud83d\udcca \uc624\ub298\uc758 \uae09\uc5ec \uc694\uc57d"}),(()=>{const e=j.reduce((e,t)=>{if("daily"===t.wage_type)return e+(t.daily_wage||0);if(t.start_time&&t.end_time&&t.jobs){const a=E.get(t.id)||0;if(a>0){const r=(0,l.c)(t.start_time,t.end_time,t.jobs).totalHours;return e+Math.round(r*a)+(t.meal_allowance||0)}}return e+(t.daily_wage||0)},0),t=j.reduce((e,t)=>e+(t.daily_wage||0),0),a=e-t,r=j.reduce((e,t)=>{if(!t.start_time||!t.end_time||!t.jobs)return e;return e+(0,l.c)(t.start_time,t.end_time,t.jobs).breakTime.breakMinutes},0);return(0,b.jsxs)("div",{className:"space-y-2",children:[e>t?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"\uae30\uc900 \uc608\uc0c1 \uae09\uc5ec:"}),(0,b.jsxs)("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:[e.toLocaleString(),"\uc6d0"]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-sm text-green-700 dark:text-green-400",children:"\uc2e4\uc81c \ubc1b\ub294 \uae09\uc5ec:"}),(0,b.jsxs)("span",{className:"font-bold text-green-700 dark:text-green-400 text-lg",children:[t.toLocaleString(),"\uc6d0"]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-sm text-orange-600 dark:text-orange-400",children:"\ud734\uac8c\uc2dc\uac04 \ucc28\uac10:"}),(0,b.jsxs)("span",{className:"font-medium text-orange-600 dark:text-orange-400",children:["-",a.toLocaleString(),"\uc6d0"]})]})]}):(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-sm text-green-700 dark:text-green-400",children:"\ucd1d \uae09\uc5ec:"}),(0,b.jsxs)("span",{className:"font-bold text-green-700 dark:text-green-400 text-lg",children:[t.toLocaleString(),"\uc6d0"]})]}),r>0&&(0,b.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t border-blue-200 dark:border-blue-700",children:[(0,b.jsx)("span",{className:"text-sm text-blue-600 dark:text-blue-400",children:"\ucd1d \ud734\uac8c\uc2dc\uac04:"}),(0,b.jsx)("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:(0,l.f)(r)})]})]})})()]}),(0,b.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,b.jsxs)("button",{onClick:()=>{F(null),N(!0)},className:"flex-1 bg-mint-green dark:bg-mint-green-dark text-white py-3 px-4 rounded-xl font-medium hover:bg-mint-green-dark dark:hover:bg-mint-green transition-all duration-200 flex items-center justify-center gap-2",children:[(0,b.jsx)(x.A,{size:20}),"\uadfc\ubb34 \ucd94\uac00"]}),(0,b.jsx)("button",{onClick:s,className:"flex-1 bg-gray-400 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-3 px-4 rounded-xl font-medium hover:bg-gray-300 dark:hover:bg-gray-600 transition-all duration-200",children:"\ub2eb\uae30"})]})]})}),_&&(0,b.jsx)(c.default,{selectedDate:t,isOpen:_,onClose:()=>{N(!1),F(null),Y();try{window.dispatchEvent(new Event("work-records-changed"))}catch(e){}},session:n,jobs:f,recordToEdit:M,size:"large"})]}):null}},5016:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var r=a(9379),s=a(5043),i=a(446),n=a.n(i),l=a(8521),o=a(2521),d=a(8188),c=a(5843),m=a(253),u=a(9994),x=a(2901),g=(a(5015),a(61)),b=a(6632),h=a(579);const f=e=>{var t,a;let{selectedDate:i,isOpen:f,onClose:y,session:k,jobs:p,recordToEdit:v,size:j="medium",prefill:w}=e;const _=(0,m.b)(),N=(0,u.b)(),{openModal:M,closeModal:F}=(0,d.a)(),[C,S]=(0,s.useState)(""),[D,T]=(0,s.useState)(""),[Y,E]=(0,s.useState)(0),[H,L]=(0,s.useState)(""),[P,q]=(0,s.useState)(0),[I,z]=(0,s.useState)(null),[A,B]=(0,s.useState)(0),[O,U]=(0,s.useState)(!1),[V,W]=(0,s.useState)(null),[R,$]=(0,s.useState)("hourly"),[G,J]=(0,s.useState)(0),[K,Q]=(0,s.useState)({breakMinutes:0,breakHours:0,isPaid:!1}),[X,Z]=(0,s.useState)(!1),[ee,te]=(0,s.useState)({breakTimePaid:0,breakTimeUnpaid:0,wageDifference:0}),[ae,re]=(0,s.useState)(!1),[se,ie]=(0,s.useState)(!1),ne=(0,s.useCallback)(()=>{S(""),T(""),E(0),L(""),q(0),z(null),U(!1),$("hourly"),J(0),W(null),Q({breakMinutes:0,breakHours:0,isPaid:!1}),Z(!1),te({breakTimePaid:0,breakTimeUnpaid:0,wageDifference:0})},[]);(0,s.useEffect)(()=>{p.length>0&&!V&&W(p[0].id)},[p,V]),(0,s.useEffect)(()=>{f?(re(!0),setTimeout(()=>ie(!0),10),M(),v?(z(v.id),W(v.job_id),S(v.start_time?v.start_time.slice(0,5):""),T(v.end_time?v.end_time.slice(0,5):""),E(v.meal_allowance||0),L(v.notes||""),q(v.daily_wage||0),$(v.wage_type||"hourly"),"daily"===v.wage_type&&J(v.daily_wage||0)):(ne(),p.length>0&&W(p[0].id),w&&(w.jobId&&W(w.jobId),w.start&&S(w.start),w.end&&T(w.end),w.wageType&&$(w.wageType)))):(ie(!1),setTimeout(()=>re(!1),300),F())},[f,v,w,p,ne,M,F]),(0,s.useEffect)(()=>{f||setTimeout(()=>{ne()},350)},[f,ne]),(0,s.useEffect)(()=>()=>{F()},[F]),(0,s.useEffect)(()=>{(async()=>{if(!k||!V||!i)return void B(0);const{data:e,error:t}=await c.a.from("hourly_rate_history").select("hourly_rate").eq("user_id",k.user.id).eq("job_id",V).lte("effective_date",n()(i).format("YYYY-MM-DD")).or("end_date.gte.".concat(n()(i).format("YYYY-MM-DD"),",end_date.is.null")).order("effective_date",{ascending:!1}).limit(1);t?(console.error("Error fetching hourly rate for date:",t),B(0)):e&&e.length>0?B(e[0].hourly_rate):B(0)})()},[k,V,i]);const le=(0,s.useMemo)(()=>p.find(e=>e.id===V),[p,V]);(0,s.useEffect)(()=>{if("hourly"===R)if(C&&D&&0!==A){const e=(0,o.a)(C);let t=(0,o.a)(D);if(!e||!t)return q(0),void Q({breakMinutes:0,breakHours:0,isPaid:!1});if(t.isBefore(e))return U(!0),q(0),void Q({breakMinutes:0,breakHours:0,isPaid:!1});U(!1);const a=(0,b.c)(C,D,le);Q(a.breakTime);const r=(0,b.b)(C,D,le,A);te(r);let s=a.workHours;a.breakTime.isPaid&&(s=a.totalHours);const i=Math.round(s*A)+Y;I&&v&&Math.abs(i-((null===v||void 0===v?void 0:v.daily_wage)||0))>100?Z(!0):Z(!1),q(i)}else q(0),Q({breakMinutes:0,breakHours:0,isPaid:!1}),te({breakTimePaid:0,breakTimeUnpaid:0,wageDifference:0});else if("daily"===R)if(U(!1),q(G+Y),C&&D){const e=(0,b.c)(C,D,le);Q(e.breakTime),te({breakTimePaid:0,breakTimeUnpaid:0,wageDifference:0})}else Q({breakMinutes:0,breakHours:0,isPaid:!1}),te({breakTimePaid:0,breakTimeUnpaid:0,wageDifference:0})},[R,C,D,A,Y,G,le,I,v]);if(!ae)return null;const oe={small:"max-w-md",medium:"max-w-xl",large:"max-w-3xl",full:"max-w-full"}[j];return(0,h.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex justify-center items-center transition-opacity duration-300 ease-out ".concat(se?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"," overflow-y-auto p-4 z-layer-modal"),children:(0,h.jsxs)("div",{className:"bg-cream-white dark:bg-gray-900 rounded-2xl shadow-lg dark:shadow-2xl dark:shadow-black/50 p-6 w-full ".concat(oe," transform transition-all duration-300 ease-out ").concat(se?"translate-y-0 scale-100":"translate-y-10 scale-95"," my-auto"),children:[(0,h.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,h.jsx)("h2",{className:"text-xl font-bold text-dark-navy dark:text-white",children:v?"\uadfc\ubb34 \uae30\ub85d \ud3b8\uc9d1":"\uc0c8 \uadfc\ubb34 \uae30\ub85d"}),(0,h.jsx)("button",{onClick:y,className:"text-medium-gray dark:text-light-gray hover:text-dark-navy dark:hover:text-white text-2xl transition-all duration-200 ease-in-out transform hover:scale-105",children:"\xd7"})]}),(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-medium-gray dark:text-light-gray",children:"\uc9c1\uc5c5 \uc120\ud0dd"}),(0,h.jsx)("div",{className:"mt-1 flex flex-wrap gap-2",children:0===p.length?(0,h.jsx)("p",{className:"text-sm text-medium-gray dark:text-light-gray",children:"\uc9c1\uc5c5\uc744 \ucd94\uac00\ud574\uc8fc\uc138\uc694"}):p.map(e=>(0,h.jsx)("button",{onClick:()=>W(e.id),className:"px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 hover:scale-105 transform",style:(0,g.b)(e,V===e.id),children:e.job_name},e.id))})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-medium-gray dark:text-light-gray mb-2",children:"\uae09\uc5ec \ubc29\uc2dd"}),(0,h.jsxs)("div",{className:"flex gap-2",children:[(0,h.jsx)("button",{onClick:()=>$("hourly"),className:"px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200 ".concat("hourly"===R?"bg-mint-green text-white":"bg-gray-200 text-dark-navy dark:bg-gray-700 dark:text-white"),children:"\uc2dc\uae09\uc81c"}),(0,h.jsx)("button",{onClick:()=>$("daily"),className:"px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200 ".concat("daily"===R?"bg-mint-green text-white":"bg-gray-200 text-dark-navy dark:bg-gray-700 dark:text-white"),children:"\uc77c\uae09\uc81c"})]})]}),"hourly"===R&&(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{htmlFor:"hourlyRateDisplay",className:"block text-sm font-medium text-medium-gray dark:text-light-gray",children:"\uc801\uc6a9 \uc2dc\uae09"}),(0,h.jsx)("input",{type:"text",id:"hourlyRateDisplay",value:"".concat(null!=A?A.toLocaleString():"0","\uc6d0"),readOnly:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-md  bg-gray-100 dark:bg-gray-700 text-dark-navy dark:text-white sm:text-sm"})]}),"daily"===R&&(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{htmlFor:"fixedDailyWage",className:"block text-sm font-medium text-medium-gray dark:text-light-gray",children:"\uc77c\uae09 (\uc6d0)"}),(0,h.jsx)("input",{type:"number",id:"fixedDailyWage",value:G||"",onChange:e=>J(Math.max(0,parseInt(e.target.value)||0)),placeholder:"\uc608: 150000",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-md focus:outline-none focus:ring-mint-green focus:border-mint-green sm:text-sm bg-white dark:bg-charcoal-gray text-dark-navy dark:text-white"})]}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsxs)("div",{className:"flex-1",children:[(0,h.jsx)("label",{htmlFor:"startTime",className:"block text-sm font-medium text-medium-gray dark:text-light-gray",children:"\ucd9c\uadfc \uc2dc\uac04"}),(0,h.jsx)(x.a,{id:"startTime",selected:/^\d{2}:\d{2}$/.test(C)&&(null===(t=(0,o.a)(C))||void 0===t?void 0:t.toDate())||null,onChange:e=>{if(!e)return void S("");const t=n()(e);t.isValid()?S(t.format("HH:mm")):S("")},showTimeSelect:!0,showTimeSelectOnly:!0,timeIntervals:15,dateFormat:"HH:mm",timeFormat:"HH:mm",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-md focus:outline-none focus:ring-mint-green focus:border-mint-green sm:text-sm bg-white dark:bg-charcoal-gray text-dark-navy dark:text-white",inputProps:{autoComplete:"off"}})]}),(0,h.jsxs)("div",{className:"flex-1",children:[(0,h.jsx)("label",{htmlFor:"endTime",className:"block text-sm font-medium text-medium-gray dark:text-light-gray",children:"\ud1f4\uadfc \uc2dc\uac04"}),(0,h.jsx)(x.a,{id:"endTime",selected:/^\d{2}:\d{2}$/.test(D)&&(null===(a=(0,o.a)(D))||void 0===a?void 0:a.toDate())||null,onChange:e=>{if(!e)return void T("");const t=n()(e);t.isValid()?T(t.format("HH:mm")):T("")},showTimeSelect:!0,showTimeSelectOnly:!0,timeIntervals:15,dateFormat:"HH:mm",timeFormat:"HH:mm",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-md focus:outline-none focus:ring-mint-green focus:border-mint-green sm:text-sm bg-white dark:bg-charcoal-gray text-dark-navy dark:text-white",inputProps:{autoComplete:"off"}})]})]}),O&&(0,h.jsx)("p",{className:"text-red-500 text-xs mt-1",children:"\ud1f4\uadfc \uc2dc\uac04\uc740 \ucd9c\uadfc \uc2dc\uac04\ubcf4\ub2e4 \ub2a6\uc5b4\uc57c \ud574\uc694."}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{htmlFor:"mealAllowance",className:"block text-sm font-medium text-medium-gray dark:text-light-gray",children:"\uc2dd\ub300 (\uc6d0)"}),(0,h.jsx)("input",{type:"number",id:"mealAllowance",value:Y||"",onChange:e=>E(Math.max(0,parseInt(e.target.value)||0)),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-md focus:outline-none focus:ring-mint-green focus:border-mint-green sm:text-sm bg-white dark:bg-charcoal-gray text-dark-navy dark:text-white"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-medium-gray dark:text-light-gray",children:"\ube44\uace0"}),(0,h.jsx)("textarea",{id:"notes",rows:"2",value:H||"",onChange:e=>L(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-md focus:outline-none focus:ring-mint-green focus:border-mint-green sm:text-sm bg-white dark:bg-charcoal-gray text-dark-navy dark:text-white"})]})]}),(0,h.jsxs)("div",{className:"mt-6 text-right text-lg font-semibold text-mint-green",children:["\uc608\uc0c1 \uc77c\uae09: ",P.toLocaleString(),"\uc6d0"]}),K.breakMinutes>0&&(0,h.jsxs)("div",{className:"mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,h.jsx)("span",{className:"text-blue-700 dark:text-blue-300 font-medium",children:"\ud83d\udccb \uc608\uc0c1 \ud734\uac8c\uc2dc\uac04"}),(0,h.jsx)("span",{className:"text-blue-800 dark:text-blue-200 font-semibold",children:(0,b.f)(K.breakMinutes)})]}),"hourly"===R&&K.breakMinutes>0&&(0,h.jsx)("div",{className:"mt-2 pt-2 border-t border-blue-200 dark:border-blue-700",children:K.isPaid?(0,h.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,h.jsxs)("span",{className:"text-green-600 dark:text-green-400 flex items-center",children:[(0,h.jsx)(l.q,{className:"w-3 h-3 mr-1"}),"\ud734\uac8c\uc2dc\uac04 \uae09\uc5ec \ud3ec\ud568"]}),(0,h.jsxs)("span",{className:"text-green-600 dark:text-green-400 font-medium",children:["+",ee.breakTimePaid.toLocaleString(),"\uc6d0"]})]}):(0,h.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,h.jsx)("span",{className:"text-orange-600 dark:text-orange-400",children:"\ud83d\udcb8 \ud734\uac8c\uc2dc\uac04 \ubb34\uae09 \ucc28\uac10"}),(0,h.jsxs)("span",{className:"text-orange-600 dark:text-orange-400 font-medium",children:["-",ee.wageDifference.toLocaleString(),"\uc6d0"]})]})}),"daily"===R&&(0,h.jsx)("div",{className:"mt-1 text-xs text-blue-600 dark:text-blue-400",children:"\u2139\ufe0f \uc77c\uae09\uc81c\ub294 \ud734\uac8c\uc2dc\uac04\uc774 \uae09\uc5ec\uc5d0 \uc601\ud5a5 \uc5c6\uc74c"})]}),X&&(0,h.jsx)("div",{className:"mt-3 p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:(0,h.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,h.jsx)("span",{className:"text-amber-600 dark:text-amber-400 text-lg",children:"\u26a1"}),(0,h.jsxs)("div",{className:"flex-1",children:[(0,h.jsx)("p",{className:"text-sm font-medium text-amber-800 dark:text-amber-200",children:"\ud734\uac8c\uc2dc\uac04 \uc815\ucc45 \uc801\uc6a9\uc73c\ub85c \uae09\uc5ec\uac00 \uc7ac\uacc4\uc0b0\ub418\uc5c8\uc2b5\ub2c8\ub2e4"}),(0,h.jsxs)("p",{className:"text-xs text-amber-700 dark:text-amber-300 mt-1",children:["\uae30\uc874: ",((null===v||void 0===v?void 0:v.daily_wage)||0).toLocaleString(),"\uc6d0 \u2192 \uc0c8 \uacc4\uc0b0: ",P.toLocaleString(),"\uc6d0"]})]})]})}),(0,h.jsxs)("div",{className:"mt-6 flex flex-col-reverse gap-3",children:[I&&(0,h.jsx)("button",{onClick:async()=>{I?N("\uc815\ub9d0 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc5b4\uc694?",async()=>{try{const{error:e}=await c.a.from("work_records").delete().eq("id",I);if(e)throw e;_("\uc0ad\uc81c\ud588\uc5b4\uc694","success"),y(),ne()}catch(e){console.error("\uadfc\ubb34 \uae30\ub85d \uc0ad\uc81c \uc624\ub958:",e),_("\uc0ad\uc81c\ud558\uc9c0 \ubabb\ud588\uc5b4\uc694","error")}}):_("\uc0ad\uc81c\ud560 \uae30\ub85d\uc774 \uc5c6\uc5b4\uc694","error")},className:"w-full px-6 py-3 text-white bg-coral-pink rounded-full font-medium hover:bg-coral-pink-dark focus:outline-none focus:ring-2 focus:ring-coral-pink focus:ring-opacity-50 transition-all duration-200 ease-in-out transform hover:scale-105",children:"\uc0ad\uc81c"}),(0,h.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,h.jsx)("button",{onClick:y,className:"w-full px-3 py-2 bg-medium-gray text-white rounded-full font-medium hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-medium-gray focus:ring-opacity-50 transition-all duration-200 ease-in-out transform hover:scale-105",children:"\ucde8\uc18c"}),(0,h.jsx)("button",{onClick:ne,className:"w-full px-3 py-2 bg-gray-200 text-dark-navy rounded-full font-medium hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-200 focus:ring-opacity-50 transition-all duration-200  ease-in-out transform hover:scale-105 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600",children:"\ucd08\uae30\ud654"}),(0,h.jsx)("button",{onClick:async()=>{if(!k||!V||!i)return void _("\ud544\uc218 \uc815\ubcf4\ub97c \uc785\ub825\ud574\uc8fc\uc138\uc694.","error");if("hourly"===R){if(!C||!D)return void _("\uc2dc\uac04\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694.","error");if(0===A)return void _("\ud574\ub2f9 \uc9c1\uc5c5\uc758 \uc2dc\uae09\uc744 \uc124\uc815\ud574\uc8fc\uc138\uc694.","error");const e=(0,o.a)(C),t=(0,o.a)(D);if(!e||!t)return void _("\uc2dc\uac04 \ud615\uc2dd\uc744 \ud655\uc778\ud574\uc8fc\uc138\uc694.","error");if(t.isBefore(e))return void _("\ud1f4\uadfc \uc2dc\uac04\uc744 \ub2e4\uc2dc \ud655\uc778\ud574\uc8fc\uc138\uc694.","error")}else if("daily"===R){if(G<=0)return void _("\uc77c\uae09\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694.","error");if(!C||!D)return void _("\uadfc\ubb34\uc2dc\uac04\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694.","error");const e=(0,o.a)(C),t=(0,o.a)(D);if(!e||!t)return void _("\uc2dc\uac04 \ud615\uc2dd\uc744 \ud655\uc778\ud574\uc8fc\uc138\uc694.","error");if(t.isBefore(e))return void _("\ud1f4\uadfc \uc2dc\uac04\uc744 \ub2e4\uc2dc \ud655\uc778\ud574\uc8fc\uc138\uc694.","error")}let e={user_id:k.user.id,job_id:V,date:n()(i).format("YYYY-MM-DD"),meal_allowance:Y,notes:H,wage_type:R,work_description:H};if("hourly"===R){const t=(0,b.c)(C,D,le);let a=t.workHours;t.breakTime.isPaid&&(a=t.totalHours);const s=Math.round(a*A)+Y;e=(0,r.a)((0,r.a)({},e),{},{start_time:C,end_time:D,daily_wage:s})}else"daily"===R&&(e=(0,r.a)((0,r.a)({},e),{},{start_time:C,end_time:D,daily_wage:G+Y}));try{if(I){const{error:t}=await c.a.from("work_records").update(e).eq("id",I);if(t)throw t;_("\uc218\uc815\ud588\uc5b4\uc694","success")}else{const{error:t}=await c.a.from("work_records").insert([e]);if(t)throw t;_("\uc800\uc7a5\ud588\uc5b4\uc694","success")}try{window.dispatchEvent(new Event("work-records-changed"))}catch(t){}y(),ne()}catch(a){console.error("\uadfc\ubb34 \uae30\ub85d \uc800\uc7a5 \uc624\ub958:",a),_("\uc800\uc7a5\ud558\uc9c0 \ubabb\ud588\uc5b4\uc694","error")}},className:"w-full px-3 py-2 bg-mint-green text-white rounded-full font-medium hover:bg-mint-green-dark focus:outline-none focus:ring-2 focus:ring-mint-green focus:ring-opacity-50 transition-all duration-200  ease-in-out transform hover:scale-105",children:"\uc800\uc7a5"})]})]})]})})}},8188:(e,t,a)=>{a.d(t,{a:()=>i});var r=a(5043);const s=new class{constructor(){this.openModals=0}openModal(){this.openModals++,1===this.openModals&&(document.body.classList.add("modal-open"),console.log("\ud83d\udd35 \ubaa8\ub2ec \uc2dc\uc2a4\ud15c \ud65c\uc131\ud654: ".concat(this.openModals,"\uac1c")))}closeModal(){this.openModals<=0||(this.openModals--,0===this.openModals&&(document.body.classList.remove("modal-open"),console.log("\ud83d\udd34 \ubaa8\ub2ec \uc2dc\uc2a4\ud15c \ube44\ud65c\uc131\ud654: ".concat(this.openModals,"\uac1c"))))}resetAllModals(){this.openModals=0,document.body.classList.remove("modal-open"),console.log("\ud83d\udd04 \ubaa8\ub4e0 \ubaa8\ub2ec \uac15\uc81c \ub9ac\uc14b")}getActiveModals(){return this.openModals}},i=()=>({openModal:(0,r.useCallback)(()=>s.openModal(),[]),closeModal:(0,r.useCallback)(()=>s.closeModal(),[]),resetAllModals:(0,r.useCallback)(()=>s.resetAllModals(),[]),getActiveModals:(0,r.useCallback)(()=>s.getActiveModals(),[])})}}]);